<HTML>
<HEAD>
<title>80386 System Tables</title>
</HEAD>

<body>
<H1><CENTER>80386 System Tables</center></h1>
<h3><center>a reference page in our series on <i>How to Write an 
Operating System</i></center></h3>

<hr>
<a name="SystemDesc"><h2>System Descriptor Types</h2></a>

<table border>
<tr><th>Type<th>Meaning<th>Segment/Gate</tr>
<tr><td>0<td>Reserved</tr>
<tr><td>1<td>available 16-bit TSS<td>System segment</tr>
<tr><td>2<td>LDT<td>System segment</tr>
<tr><td>3<td>active 16-bit TSS<td>System segment</tr>
<tr><td>4<td>16-bit Call Gate<td>Gate</tr>
<tr><td>5<td>Task Gate<td>Gate</tr>
<tr><td>6<td>16-bit Interrupt Gate<td>Gate</tr>
<tr><td>7<td>16-bit Trap Gate<td>Gate</tr>
<tr><td>8<td>Reserved</tr>
<tr><td>9<td>available 32-bit TSS<td>System segment</tr>
<tr><td>10<td>Reserved</tr>
<tr><td>11<td>active 32-bit TSS<td>System segment</tr>
<tr><td>12<td>32-bit Call Gate<td>Gate</tr>
<tr><td>13<td>Reserved</tr>
<tr><td>14<td>32-bit Interrupt Gate<td>Gate</tr>
<tr><td>15<td>32-bit Trap Gate<td>Gate</tr>
</table>

<a name="TSS"><h2>Task State Segment</h2></a>

<p>Most of the fields in the TSS mirror the 
<a href="regs.html">32-bit register set</a>.  

<br>
<table border>
<tr><th>MSW (upper 16 bits)<th>LSW (lower 16 bits)<th>Offset</tr>
<tr><td align=center><a href="#iomapbase">I/O Map Base</a>
<td align=center><a href="#trapbit">T</a><td>+100 (64h)</tr>
<tr><td align=center>0<td align=center>LDTR<td>+96 (60h)</tr>
<tr><td align=center>0<td align=center>GS selector<td>+92 (5ch)</tr>
<tr><td align=center>0<td align=center>FS selector<td>+88 (58h)</tr>
<tr><td align=center>0<td align=center>DS selector<td>+84 (54h)</tr>
<tr><td align=center>0<td align=center>SS selector<td>+80 (50h)</tr>
<tr><td align=center>0<td align=center>CS selector<td>+76 (4ch)</tr>
<tr><td align=center>0<td align=center>ES selector<td>+72 (48h)</tr>
<tr><td align=center colspan=2>EDI<td>+68 (44h)</tr>
<tr><td align=center colspan=2>ESI<td>+64 (40h)</tr>
<tr><td align=center colspan=2>EBP<td>+60 (3ch)</tr>
<tr><td align=center colspan=2>ESP<td>+56 (38h)</tr>
<tr><td align=center colspan=2>EBX<td>+52 (34h)</tr>
<tr><td align=center colspan=2>EDX<td>+48 (30h)</tr>
<tr><td align=center colspan=2>ECX<td>+44 (2ch)</tr>
<tr><td align=center colspan=2>EAX<td>+40 (28h)</tr>
<tr><td align=center colspan=2><a href="regs.html#eflags">eFlags</a>
<td>+36 (24h)</tr>
<tr><td align=center colspan=2>EIP<td>+32 (20h)</tr>
<tr><td align=center colspan=2><a href="7.a.html#PDBR">CR3 (PDBR)</a>
<td>+28 (1ch)</tr>
<tr><td align=center>0<td align=center>SS for CPL2<td>+24 (18h)</tr>
<tr><td align=center colspan=2>ESP for CPL2<td>+20 (14h)</tr>
<tr><td align=center>0<td align=center>SS for CPL1<td>+16 (10h)</tr>
<tr><td align=center colspan=2>ESP for CPL1<td>+12 (0ch)</tr>
<tr><td align=center>0<td align=center>SS for CPL0<td>+8 (08h)</tr>
<tr><td align=center colspan=2>ESP for CPL0<td>+4 (04h)</tr>
<tr><td align=center>0<td align=center><a href="#backlink">Backlink</a><td>+0 (00h)</tr>
</table>

<ul>
<li>The <b>I/O map base</b> field is an offset from the beginning of 
the TSS, pointing to the 
<a href="#IOmap">I/O permissions map</a> for this task.
<li>The <b>T bit</b> (the least significant bit of the word at offset 64h)
is the Trace Bit, and tells the processor to cause a Debug Exception
when this context is run.
<li>The <b>backlink field</b> holds a selector for the TSS that this
context was called from (only valid if running).
</ul>

<hr>
<!--#include virtual="/include/footer.html" -->
</BODY>
</HTML>

